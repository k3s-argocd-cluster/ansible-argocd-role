---

- name: Create directories
  ansible.builtin.file:
    path: "{{ role_path }}/files/bootstrap-k3s/{{ item.path }}"
    state: directory
    mode: '{{ item.mode }}'
  when: item.state == 'directory'

- name: Render templates
  ansible.builtin.template:
    src: '{{ item.src }}'
    dest: "{{ role_path }}/files/bootstrap-k3s/{{ item.path }}"
    mode: '{{ item.mode }}'
  when: item.state == 'file'

- name: Mark file as being a generated template
  ansible.builtin.lineinfile :
    path: "{{ role_path }}/files/bootstrap-k3s/{{ item.path }}"
    insertbefore: BOF
    line: '### Generated by ansible :: demelopment.k3s.argocd@render_templates ###'
  when: item.state == 'file'